<!DOCTYPE html> <!--Good for processing-->
<html>
    <head>
        <!--metadata-->
        <title>Java Flights API</title>
        <link rel="stylesheet" href ="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <style>
            h1{
                color: navy;
                text-align: center;
                padding: 30px;
                padding-left: 335px;
             }

             h2{
                 color: navy;
                 padding-left: 150px;
             }

             h3{
                 color: black;
                 padding-left: 300px;
             }
            
            #home-list {
                background-color:green;
                padding: 150x;
            }
            .box {
                padding: 50px;
            }

            .submit-button{
                background-color: green;
                margin-left: 350px;
            }

            .form-group{
                padding-left: 50px;
            }

        </style>

    </head>
    <body>
        <div class="cointainer-fluid">
            <div class="text-lg-left">
              <div>
                <img src="titlePlane1.jpg" class="img-fluid">
                <h1>Welcome to Java Flights</h1>
              </div>
            </div>
            <div class ="row">
                <div class="col-lg-4">
                    <h2>Add Flight</h2>
                    <form id="add-flight-form">
                        <div class="form-group">
                            <label for="airline">Airline</label>
                            <input class="form-control" id = "airline" placeholder="Delta" />
                        </div>
                        <p></p>
                        <div class="form-group">
                            <label for="origin">Origin</label>
                            <input class="form-control"  id = "origin" placeholder="JFK"/>
                        </div>
                        <p></p>
                        <div class="form-group">
                            <label for="destination">Destination</label>
                            <input class="form-control" id = "destination" placeholder="RDU" />
                        </div>
                        <p></p>
                        <div class="form-group" >
                            <label for="departure">Departure</label>
                            <input class="form-control" id = "departure" placeholder="722PM"  />
                        </div>
                        <p></p>
                        <div class="form-group">
                            <label for="arrival">Arrival</label>
                            <input class="form-control" id = "arrival" placeholder="1055PM" />
                        </div>
                        <p></p>
                        <div class="form-group">
                            <label for="flight Number">Flight Number</label>
                            <input class="form-control" id = "flightNumber" placeholder="D10991" />
                        </div>
                        <p></p>
                        <div>
                            <input class="btn btn-primary mr 1 submit-button" type="submit" id="add-flight" value="Add Flight"  />
                        </div>
                        <p></p>
                    </form>
                </div>
                <div id="home-list" class = "col-lg-7">  
                    <h3 class="text-lg-left">Scheduled Flights</h3>
                    <table id="flight-data" class = "table">
                        <thead class="thead-dark">
                            <tr>
                                <th scope ="col">ID</th>
                                <th scope ="col">Airline</th>
                                <th scope="col">Origin</th>
                                <th scope="col">Destination</th>
                                <th scope="col">Departure</th>
                                <th scope="col">Arrival</th>
                                <th scope="col">Flight Number</th>
                            </tr>
                        </thread>
                    </table>
             </div>
            </div>
        </div>
            <div class="cointainer-fluid">
                <div class="col-lg-4">
                    <form id="update-flight-form">
                        <h2>Update Flight Number</h2>
                            <div class="form-group">
                                <label for="updateairline">Airline</label>
                                <input class="form-control" id = "updateairline" placeholder="DELTA" />
                            </div>
                            <p></p>
                            <div class="form-group">
                                <label for="updateflightNumber">Flight Number</label>
                                <input class="form-control" id = "updateflightNumber" placeholder="DL1091" />
                            </div>
                            <p></p>
                            <div class="form-group">
                                <label for="updateflightId">Flight ID</label>
                                <input class="form-control" id = "updateflightId" placeholder="25" />
                            </div>
                            <p></p>
                            <div>
                            <input class="btn btn-primary mr 1 submit-button" type="submit" value="Update Flight" />
                            </div>
                    </form>
                </div>
            </div>
                <form id = "delete-flight-form">
                    <h2>Delete Flight</h2>
                    <div class="col-lg-4 form-group">
                        <label for="delete flight Number">Flight ID</label>
                        <input type="text" class ="form-control" id = "deleteflightNumber" placeholder="25" />
                    </div>    
                    <p></p>    
                    <div>
                        <input class="btn btn-primary mr 1 submit-button" type="submit" value="Delete Flight" />
                    </div>
                </form>
        </div>
    </body>
    <script type="text/javascript">
        document.getElementById('update-flight-form').addEventListener('submit', function(event){
            event.preventDefault();
            var airline_on_form = document.getElementById('updateairline').value;
            var flightNumber_on_form = document.getElementById('updateflightNumber').value;
            var flightId_on_form = document.getElementById('updateflightId').value;

            console.log('hey');
            var xhr = new XMLHttpRequest();
            xhr.onreadyStatechange = function(){
                if(xhr.readyState == 4 && xhr.status == 201){
                    window.alert('muy done');
                }
            }
                    var url = 'http://localhost:8080/flight.api/api/flight';
                    var url1 ='?id=';
                    var url2 = '&airline=';
                    var url3 = '&fid=';
                    var finalUrl = url + url1 + flightId_on_form + url2 + airline_on_form + url3 + flightNumber_on_form;
                    console.log(finalUrl);
                    xhr.open('PUT', finalUrl);
                    xhr.send();
             
        });
        document.getElementById('delete-flight-form').addEventListener('submit', function(event){
            event.preventDefault();
            var deleteFlightNumber_on_form = document.getElementById('deleteflightNumber').value;
            var xhr = new XMLHttpRequest();
            console.log(deleteFlightNumber_on_form);
            xhr.onreadystatechange = function(){
                if(xhr.readyState == 4 && xhr.status == 200){
                    window.alert('almost done')
                }
            }
                var urlstart = 'http://localhost:8080/flight.api/api/flight';
                var urlmiddle = '?id='
                var url = urlstart + urlmiddle + deleteFlightNumber_on_form;
                console.log(url);
                xhr.open('DELETE', url);
                xhr.send();
            
        });
        // Add Flight
        document.getElementById('add-flight-form').addEventListener('submit', function(event){
            event.preventDefault();
            var airline_on_form = document.getElementById('airline').value;
            var origin_on_form = document.getElementById('origin').value;
            var destination_on_form = document.getElementById('destination').value;
            var departure_on_form = document.getElementById('departure').value;
            var arrival_on_form = document.getElementById('arrival').value;
            var flightNumber_on_form = document.getElementById('flightNumber').value;
            var flight = {
                airline: airline_on_form,
                fromAirport: origin_on_form,
                toAirport: destination_on_form,
                departure: departure_on_form,
                arrival: arrival_on_form,
                flightNumber: flightNumber_on_form
            };
            var xhr = new XMLHttpRequest();
            console.log(flight);
            xhr.onreadystatechange = function(){
                if(xhr.readyState === 4 && xhr.status === 201){
                    window.alert('done');
                }
            }
                
                xhr.open('POST', 'http://localhost:8080/flight.api/api/flight');
                xhr.send(JSON.stringify(flight));
    
        });
        // Ajax - asynchronous JavaScript and XML
        // XHR core object of Ajax
        window.onload = function(response){
            let xhr = new XMLHttpRequest();
            
            xhr.onreadystatechange = function(){

                if(xhr.readyState === 4){
                    var flightArray = JSON.parse(xhr.responseText);
                    console.log(flightArray)
                    flightArray.forEach(flight => {
                        addFlightToTable(flight)
                    });
                   /** for(let flight in flightArray){
                        console.log('for loop: adding flight')
                        addFlightToTable(flight);
                    }*/
                }
            }

            xhr.open('GET', 'http://localhost:8080/flight.api/api/flight');
            
            xhr.send();
        } 

        function addFlightToTable(flight){
            var tr = document.createElement('tr');
            var id = document.createElement('td');
            var airline = document.createElement('td');
            var fromAirport = document.createElement('td');
            var toAirport = document.createElement('td');
            var departure = document.createElement('td');
            var arrival = document.createElement('td');
            var flightNumber = document.createElement('td');
            id.innerText = flight.id;
            airline.innerText = flight.airline;
            fromAirport.innerText = flight.fromAirport;
            toAirport.innerText = flight.toAirport;
            departure.innerText = flight.departure;
            arrival.innerText = flight.arrival;
            flightNumber.innerText = flight.flightNumber;
            tr.appendChild(id);
            tr.appendChild(airline);
            tr.appendChild(fromAirport);
            tr.appendChild(toAirport);
            tr.appendChild(departure);
            tr.appendChild(arrival);
            tr.appendChild(flightNumber);
            document.getElementById("flight-data").appendChild(tr);
        }
    </script>
</html>